# Пользователь-Атрибут (User-Subscription) #
Сервис для управления пользователями и их атрибутами. Проект написан на Java с использованием фреймворка Spring Boot.
## Описание проекта ##
Данный проект реализует RESTful API для управления пользователями и их атрибутами, такими как: аккаунт(баланс), номер телефона, email, день рождения, имени. Основные функциональные возможности включают:
* Трансфер денежных средств между пользователями (Spring Transaction)
* Получения пользователей динамически с помощью параметров (реализация Specification)
* Управление почтовыми ящиками (добавление, изменение, удаление)
* Управление телефонами (добавление, удаление, изменение)
* Изменение параметров пользователя (дата рождения, имя)

<br>  Сервис построен с учётом принципов отказоустойчивости и производительности. Код сопровожден документацией и комментариями для лучшего понимания архитектуры и функциональных деталей.

## Требования ##

* Java 17+
* Apache Maven
* PostgreSQL (рекомендуемая версия 16+)
* Docker (для быстрого старта)

## Установка и запуск ##

Для установки и запуска сервиса выполните следующие шаги:

### 1. Скачать исходный код: ###
```
 git clone https://github.com/AntonBuzynnikov/user-subscription-service
 cd user-subscription-service
```

### 2. Выполнить команду для сборки проекта: ###
```
 mvn clean package
```

### 3. Запустить Docker-compose: ###
```
docker compose up
```

Проект имеет базовые настройки для запуска, поэтому дополнительной настройки не требуется

Если необходимо, можете изменить переменные окружение Spring Boot, такие как:
```
 SPRING_DATASOURCE_URL
 SPRING_DATASOURCE_USERNAME
 SPRING_DATASOURCE_PASSWORD
```

Со списком всех параметров можно ознакомиться в документации к Spring.

## Тестирование ##

## ВАЖНО! По умолчанию добавлены 3 пользователя, аккаунты, номера телефонов и имэйлы к ним (дальнейшее добавление пользователей и аккаунтов возможно с помощью миграций, либо UI для баз данных) ##

Тестируйте сервис с помощью curl или Postman:
## 0. Аутентификация ##
По итогом этой операции Вы получите токен доступа для дальнейших операций, в каждый запрос нужно будет добавлять токен Bearer
```
    {
        "email":**{example@mail.ru}**,
        "password":**{password}**
    }
    
    POST http://{HOST}:{PORT}/api/v1/auth/sign-in
```

### 1. Трансфер ###
```
    {
        "toId":**{id_пользователя, кому предназначен перевод}**,
        "amount":{сумма перевода} #минимальная сумма 10
    }
    
    PUT http://{HOST}:{PORT}/api/v1/accounts/transfer
```
### Для проверки баланса ###

``` 
    GET http://{HOST}:{PORT}/api/v1/accounts/balance
```

### 2. Поиск пользователей ###
```
GET http://{HOST}:{PORT}/api/v1/users/find?name={поиск_по_оператору_LIKE}&phone={полное_соответсвие, от 9 до 13 цифр без +}&email={валидный_имэйл, полное соответсвие}&date-of-birth={dd.MM.yyyy}&page={}&size={}
```
Все параметры необязательные. В случае отсутсвия параметров вернёт постраничный список пользователей.

### 3. Изменение пользователя ###

```
    PATCH http://{HOST}:{PORT}/api/v1/users/update-date/{dateOfBirth}

    PATCH http://{HOST}:{PORT}/api/v1/users/update-name/{name}
```
Конечные точка возвращает ответ:
```
Status: 204
```
### 4. Управление email ###
Создание:
```
    {
        "email":{email}
    }

    POST http://{HOST}:{PORT}/api/v1/email
```

Возврат: созданный email

Удаление:

```
    {
        "email":{email}
    }

    DELETE http://{HOST}:{PORT}/api/v1/email
```

Обновление:
```
    {
        "email":{email}
    }

    PATCH http://{HOST}:{PORT}/api/v1/email
```

### 5. Управление номером телефона ###

Создание:
```
    {
        "phone":{phone}
    }

    POST http://{HOST}:{PORT}/api/v1/email
```

Возврат: созданный email

Удаление:

```
    {
        "email":{email}
    }

    DELETE http://{HOST}:{PORT}/api/v1/email
```

Обновление:
```
    {
        "email":{email}
    }

    PATCH http://{HOST}:{PORT}/api/v1/email
```
Конечная точка возвращает ответ:
```
Status: 204
```
### 6. Удаление подписки у пользователя ###

```
    DELETE http://{HOST}:{PORT}/api/v1/users/{id}/subscriptions/{subscriptionId}
```
Конечная точка возвращает ответ:
```
Status: 204
```
### 7. Получение топ-3 подписок ###

Исходя из количества подписанных пользователей

```
    GET http://{HOST}:{PORT}/api/v1/subscriptions/top
```
Конечная точка возвращает ответ:

```
Status: 200
[
    {
        "id": {id1}
        "name": {имя_подписки1}
    },
    {
        "id": {id2}
        "name": {имя_подписки2}
    },
    {
        "id": {id2}
        "name": {имя_подписки2}
    }
]
```
### 8. Получение подписок пользователя ###

Исходя из количества подписанных пользователей

```
    GET http://{HOST}:{PORT}/api/v1/user/{id}/subscriptions
```
Конечная точка возвращает ответ:

```
Status: 200
[
    {
        "id": {id1}
        "name": {имя_подписки1}
    },
    {
        "id": {id2}
        "name": {имя_подписки2}
    },
    {
        "id": {id2}
        "name": {имя_подписки2}
    }
]
```

### Возможные ошибки: ###
1. **Пользователь не найден:** возвращает **Status 404** и описание ошибки
2. **Подписка не найдена:** возвращает **Status 404** и описание ошибки
3. **Ошибки валидации:** возникает из-за неправильных данных у параметров **id** и **name**. Возвращает **Status 400** и описание ошибки
4. **Дублирование данных:** возвращает **Status 409** и описание ошибки. Возникает при попытке повторно добавить пользователю ту же самую подписку

## Поддерживаемые технологии ##

* Spring Boot
* Hibernate/JPA
* Docker/Docker Compose
* PostgreSQL

## Авторство ##
Автор проекта: Антон Бузынников.
